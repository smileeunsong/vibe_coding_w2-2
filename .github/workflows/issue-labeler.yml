name: ì´ìŠˆ ë¼ë²¨ ìë™ ë“±ë¡

on:
  issues:
    types: [opened, edited]

jobs:
  label-issue:
    runs-on: ubuntu-latest

    steps:
      - name: ì´ìŠˆ ìë™ ë¼ë²¨ë§
        uses: actions/github-script@v6
        with:
          script: |
            const issue = context.payload.issue;
            const issueTitle = issue.title.toLowerCase();
            const issueBody = issue.body ? issue.body.toLowerCase() : '';

            let labels = [];

            // ì´ìŠˆ ìœ í˜• ê¸°ë°˜ ë¼ë²¨ë§
            if (issueTitle.includes('bug') || issueBody.includes('error') || issueBody.includes('ë¬¸ì œ') || issueBody.includes('ë²„ê·¸')) {
              labels.push('type/bug');
              
              // ë²„ê·¸ ì‹¬ê°ë„ ë¶„ì„
              if (issueBody.includes('í¬ë˜ì‹œ') || issueBody.includes('crash') || issueBody.includes('ì‹¬ê°') || issueBody.includes('critical')) {
                labels.push('priority/critical', 'severity/high');
              } else if (issueBody.includes('ë¸”ë¡œí‚¹') || issueBody.includes('blocking') || issueBody.includes('ë§‰í˜')) {
                labels.push('priority/high', 'severity/medium');
              } else {
                labels.push('priority/medium', 'severity/low');
              }
            } else if (issueTitle.includes('feature') || issueTitle.includes('ê¸°ëŠ¥') || issueBody.includes('ì¶”ê°€') || issueBody.includes('ìƒˆë¡œìš´')) {
              labels.push('type/enhancement');
              labels.push('priority/medium');
            } else if (issueTitle.includes('question') || issueTitle.includes('ì§ˆë¬¸') || issueTitle.includes('ë„ì›€') || issueTitle.includes('how')) {
              labels.push('type/question');
              labels.push('priority/low');
            } else if (issueTitle.includes('documentation') || issueTitle.includes('ë¬¸ì„œ') || issueTitle.includes('doc')) {
              labels.push('type/documentation');
              labels.push('priority/low');
            } else if (issueTitle.includes('performance') || issueTitle.includes('ì„±ëŠ¥') || issueTitle.includes('ëŠë¦¼') || issueTitle.includes('slow')) {
              labels.push('type/performance');
              labels.push('priority/medium');
            } else if (issueTitle.includes('security') || issueTitle.includes('ë³´ì•ˆ') || issueTitle.includes('ì·¨ì•½ì ')) {
              labels.push('type/security');
              labels.push('priority/high');
            } else {
              labels.push('type/other');
              labels.push('priority/medium');
            }

            // ì˜ì—­ë³„ ë¼ë²¨ë§
            if (issueBody.includes('api') || issueBody.includes('backend') || issueBody.includes('ì„œë²„') || issueBody.includes('fastapi')) {
              labels.push('area/backend');
            }
            if (issueBody.includes('ui') || issueBody.includes('frontend') || issueBody.includes('í™”ë©´') || issueBody.includes('streamlit')) {
              labels.push('area/frontend');
            }
            if (issueBody.includes('test') || issueBody.includes('í…ŒìŠ¤íŠ¸') || issueBody.includes('pytest')) {
              labels.push('area/testing');
            }
            if (issueBody.includes('deploy') || issueBody.includes('ë°°í¬') || issueBody.includes('ci/cd') || issueBody.includes('docker')) {
              labels.push('area/devops');
            }
            if (issueBody.includes('database') || issueBody.includes('db') || issueBody.includes('ë°ì´í„°ë² ì´ìŠ¤')) {
              labels.push('area/database');
            }

            // ìƒíƒœ ë¼ë²¨ë§
            labels.push('status/triage');  // ìƒˆë¡œìš´ ì´ìŠˆëŠ” ìš°ì„  íŠ¸ë¦¬ì•„ì§€ ìƒíƒœ

            // íŠ¹ë³„ ë¼ë²¨ë§
            if (issueTitle.includes('good first issue') || issueBody.includes('ì´ˆë³´ì')) {
              labels.push('good-first-issue');
            }
            if (issueTitle.includes('help wanted') || issueBody.includes('ë„ì›€ í•„ìš”')) {
              labels.push('help-wanted');
            }
            if (issueTitle.includes('duplicate') || issueBody.includes('ì¤‘ë³µ')) {
              labels.push('duplicate');
            }

            // í”Œë«í¼/í™˜ê²½ ë¼ë²¨ë§
            if (issueBody.includes('windows') || issueBody.includes('ìœˆë„ìš°')) {
              labels.push('platform/windows');
            }
            if (issueBody.includes('macos') || issueBody.includes('mac')) {
              labels.push('platform/macos');
            }
            if (issueBody.includes('linux') || issueBody.includes('ë¦¬ëˆ…ìŠ¤')) {
              labels.push('platform/linux');
            }
            if (issueBody.includes('chrome') || issueBody.includes('firefox') || issueBody.includes('safari') || issueBody.includes('ë¸Œë¼ìš°ì €')) {
              labels.push('platform/browser');
            }

            // ì»´í¬ë„ŒíŠ¸ë³„ ë¼ë²¨ë§ (í”„ë¡œì íŠ¸ êµ¬ì¡° ê¸°ë°˜)
            if (issueBody.includes('langgraph') || issueBody.includes('agent') || issueBody.includes('ì—ì´ì „íŠ¸')) {
              labels.push('component/langgraph');
            }
            if (issueBody.includes('gemini') || issueBody.includes('llm') || issueBody.includes('ai')) {
              labels.push('component/llm');
            }
            if (issueBody.includes('chat') || issueBody.includes('ì±„íŒ…') || issueBody.includes('ëŒ€í™”')) {
              labels.push('component/chat');
            }

            // ì¤‘ë³µ ì œê±°
            labels = [...new Set(labels)];

            try {
              // ë¼ë²¨ ì ìš©
              if (labels.length > 0) {
                await github.rest.issues.setLabels({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issue.number,
                  labels: labels
                });
                
                console.log(`ì ìš©ëœ ë¼ë²¨: ${labels.join(', ')}`);
                
                // ë¼ë²¨ë§ ê²°ê³¼ ëŒ“ê¸€ (í¸ì§‘ëœ ì´ìŠˆê°€ ì•„ë‹Œ ê²½ìš°ë§Œ)
                if (context.payload.action === 'opened') {
                  const comment = `
                  ## ğŸ·ï¸ ìë™ ë¼ë²¨ë§ ì™„ë£Œ
                  
                  ë‹¤ìŒ ë¼ë²¨ì´ ìë™ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤:
                  
                  ${labels.map(label => {
                    if (label.startsWith('type/')) return `**ìœ í˜•**: \`${label}\``;
                    if (label.startsWith('priority/')) return `**ìš°ì„ ìˆœìœ„**: \`${label}\``;
                    if (label.startsWith('area/')) return `**ì˜ì—­**: \`${label}\``;
                    if (label.startsWith('status/')) return `**ìƒíƒœ**: \`${label}\``;
                    if (label.startsWith('platform/')) return `**í”Œë«í¼**: \`${label}\``;
                    if (label.startsWith('component/')) return `**ì»´í¬ë„ŒíŠ¸**: \`${label}\``;
                    return `**ê¸°íƒ€**: \`${label}\``;
                  }).join('\n')}
                  
                  ### ğŸ“ ë¼ë²¨ ì„¤ëª…
                  - **type/**: ì´ìŠˆì˜ ìœ í˜• (bug, enhancement, question ë“±)
                  - **priority/**: ìš°ì„ ìˆœìœ„ (critical, high, medium, low)
                  - **area/**: ê´€ë ¨ ì˜ì—­ (backend, frontend, testing ë“±)
                  - **status/**: ì§„í–‰ ìƒíƒœ (triage, todo, in-progress ë“±)
                  
                  ë¼ë²¨ì´ ì˜ëª» ì ìš©ë˜ì—ˆë‹¤ë©´ ìˆ˜ë™ìœ¼ë¡œ ìˆ˜ì •í•´ì£¼ì„¸ìš”!
                  
                  ---
                  *ìë™ ë¼ë²¨ë§ ì‹œìŠ¤í…œì— ì˜í•´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.* ğŸ¤–
                  `;
                  
                  await github.rest.issues.createComment({
                    issue_number: issue.number,
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    body: comment
                  });
                }
              }
              
            } catch (error) {
              console.error('ë¼ë²¨ ì ìš© ì¤‘ ì˜¤ë¥˜:', error);
            }
