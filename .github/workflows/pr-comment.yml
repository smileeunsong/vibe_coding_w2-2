name: PR ìë™ ëŒ“ê¸€

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  pr-comment:
    runs-on: ubuntu-latest

    steps:
      - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: PR ì •ë³´ ìˆ˜ì§‘
        id: pr-info
        run: |
          echo "pr_number=${{ github.event.pull_request.number }}" >> $GITHUB_OUTPUT
          echo "pr_title=${{ github.event.pull_request.title }}" >> $GITHUB_OUTPUT
          echo "pr_author=${{ github.event.pull_request.user.login }}" >> $GITHUB_OUTPUT
          echo "branch_name=${{ github.event.pull_request.head.ref }}" >> $GITHUB_OUTPUT

          # ë³€ê²½ëœ íŒŒì¼ ë¶„ì„
          FILES_CHANGED=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/pulls/${{ github.event.pull_request.number }}/files" | \
            jq -r '.[].filename' | head -10)

          echo "files_changed<<EOF" >> $GITHUB_OUTPUT
          echo "$FILES_CHANGED" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: ìë™ ëŒ“ê¸€ ì‘ì„±
        uses: actions/github-script@v6
        with:
          script: |
            const prNumber = ${{ steps.pr-info.outputs.pr_number }};
            const prTitle = `${{ steps.pr-info.outputs.pr_title }}`;
            const prAuthor = `${{ steps.pr-info.outputs.pr_author }}`;
            const branchName = `${{ steps.pr-info.outputs.branch_name }}`;
            const filesChanged = `${{ steps.pr-info.outputs.files_changed }}`;

            const comment = `
            ## ğŸ‰ PR ìë™ ë¶„ì„ ê²°ê³¼

            **ì‘ì„±ì**: @${prAuthor}
            **ë¸Œëœì¹˜**: \`${branchName}\`

            ### ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸
            - [ ] ì½”ë“œ ë¦¬ë·° ì™„ë£Œ
            - [ ] í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±/ì—…ë°ì´íŠ¸
            - [ ] ë¬¸ì„œ ì—…ë°ì´íŠ¸ (í•„ìš”ì‹œ)
            - [ ] ë¸Œëœì¹˜ëª… ê·œì¹™ ì¤€ìˆ˜ í™•ì¸

            ### ğŸ“ ì£¼ìš” ë³€ê²½ íŒŒì¼
            \`\`\`
            ${filesChanged.split('\n').slice(0, 10).join('\n')}
            \`\`\`

            ### ğŸ” ë¦¬ë·° ê°€ì´ë“œ
            - ë³€ê²½ì‚¬í•­ì´ ìš”êµ¬ì‚¬í•­ì— ë§ëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”
            - í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ì¶©ë¶„íˆ ì‘ì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”
            - ì½”ë”© ì»¨ë²¤ì…˜ì„ ì¤€ìˆ˜í–ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”

            ---
            *ì´ ëŒ“ê¸€ì€ ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.* ğŸ¤–
            `;

            github.rest.issues.createComment({
              issue_number: prNumber,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });
